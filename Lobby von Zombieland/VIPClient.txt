-- VIPClient.lua
-- Platzierung: StarterPlayer/StarterPlayerScripts/VIPClient (LocalScript)

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local Debris = game:GetService("Debris")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Remote Event mit Timeout
local remotes = ReplicatedStorage:WaitForChild("LobbyRemotes", 10)
if not remotes then
	warn("[VIP CLIENT] LobbyRemotes not found")
	return
end

local vipMessageRemote = remotes:WaitForChild("VIPMessage", 10)
if not vipMessageRemote then
	warn("[VIP CLIENT] VIPMessage remote not found - VIP system might not be running")
	return
end

-- Debounce f√ºr Nachrichten
local messageDebounce = false
local lastMessageTime = 0
local MESSAGE_COOLDOWN = 3 -- Sekunden zwischen Nachrichten

-- Funktion f√ºr VIP Nachricht
local function showVIPMessage(isVIP, rank)
	-- Check cooldown
	if tick() - lastMessageTime < MESSAGE_COOLDOWN then
		return
	end
	lastMessageTime = tick()

	-- Entferne alte Nachrichten
	if playerGui:FindFirstChild("VIPNotification") then
		playerGui.VIPNotification:Destroy()
	end

	-- Erstelle GUI
	local screenGui = Instance.new("ScreenGui")
	screenGui.Name = "VIPNotification"
	screenGui.ResetOnSpawn = false
	screenGui.DisplayOrder = 10
	screenGui.Parent = playerGui

	-- Hauptframe
	local frame = Instance.new("Frame")
	frame.Size = UDim2.new(0, 0, 0, 0) -- Start klein f√ºr Animation
	frame.Position = UDim2.new(0.5, 0, 0.4, 0)
	frame.AnchorPoint = Vector2.new(0.5, 0.5)
	frame.BackgroundColor3 = isVIP and Color3.fromRGB(50, 50, 150) or Color3.fromRGB(150, 50, 50)
	frame.BorderSizePixel = 0
	frame.Parent = screenGui

	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 20)
	corner.Parent = frame

	local gradient = Instance.new("UIGradient")
	gradient.Color = ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 0, 0)),
		ColorSequenceKeypoint.new(0.5, Color3.fromRGB(255, 255, 255)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 0, 0))
	}
	gradient.Transparency = NumberSequence.new{
		NumberSequenceKeypoint.new(0, 0.5),
		NumberSequenceKeypoint.new(0.5, 0),
		NumberSequenceKeypoint.new(1, 0.5)
	}
	gradient.Rotation = 45
	gradient.Parent = frame

	-- Glowing Border
	local stroke = Instance.new("UIStroke")
	stroke.Color = isVIP and Color3.fromRGB(255, 215, 0) or Color3.fromRGB(255, 100, 100)
	stroke.Thickness = 4
	stroke.Transparency = 0
	stroke.Parent = frame

	-- Icon
	local iconLabel = Instance.new("TextLabel")
	iconLabel.Size = UDim2.new(0.2, 0, 1, 0)
	iconLabel.Position = UDim2.new(0, 0, 0, 0)
	iconLabel.BackgroundTransparency = 1
	iconLabel.Text = isVIP and "üëë" or "üö´"
	iconLabel.TextScaled = true
	iconLabel.Font = Enum.Font.SourceSansBold
	iconLabel.TextColor3 = Color3.new(1, 1, 1)
	iconLabel.Parent = frame

	-- Haupttext
	local textLabel = Instance.new("TextLabel")
	textLabel.Size = UDim2.new(0.8, 0, 0.6, 0)
	textLabel.Position = UDim2.new(0.2, 0, 0, 0)
	textLabel.BackgroundTransparency = 1

	if isVIP then
		textLabel.Text = "WELCOME VIP!"
		textLabel.TextColor3 = Color3.fromRGB(255, 215, 0)
	else
		textLabel.Text = "YOU ARE NOT VIP"
		textLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
	end

	textLabel.TextScaled = true
	textLabel.Font = Enum.Font.SourceSansBold
	textLabel.Parent = frame

	local textStroke = Instance.new("UIStroke")
	textStroke.Color = Color3.new(0, 0, 0)
	textStroke.Thickness = 2
	textStroke.Parent = textLabel

	-- Subtext
	local subLabel = Instance.new("TextLabel")
	subLabel.Size = UDim2.new(0.8, 0, 0.4, 0)
	subLabel.Position = UDim2.new(0.2, 0, 0.6, 0)
	subLabel.BackgroundTransparency = 1

	if isVIP then
		subLabel.Text = "Rank #" .. tostring(rank) .. " ‚Ä¢ Top 25 Player"
		subLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
	else
		subLabel.Text = "Get into Top 25 to access VIP Area!"
		subLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
	end

	subLabel.TextScaled = true
	subLabel.Font = Enum.Font.SourceSans
	subLabel.Parent = frame

	-- Animations
	-- Erscheinen
	TweenService:Create(frame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
		Size = UDim2.new(0, 500, 0, 150)
	}):Play()

	-- Pulsierender Glow-Effekt
	spawn(function()
		for i = 1, 3 do
			if not frame.Parent then break end
			TweenService:Create(stroke, TweenInfo.new(0.3), {
				Thickness = 8,
				Transparency = 0.3
			}):Play()
			wait(0.3)
			TweenService:Create(stroke, TweenInfo.new(0.3), {
				Thickness = 4,
				Transparency = 0
			}):Play()
			wait(0.3)
		end
	end)

	-- Shake-Effekt f√ºr Nicht-VIPs
	if not isVIP then
		spawn(function()
			local originalPos = frame.Position
			for i = 1, 10 do
				if not frame.Parent then break end
				frame.Position = originalPos + UDim2.new(0, math.random(-5, 5), 0, math.random(-5, 5))
				wait(0.05)
			end
			frame.Position = originalPos
		end)

		-- Sound-Effekt (optional)
		local sound = Instance.new("Sound")
		sound.SoundId = "rbxasset://sounds/bass.wav"
		sound.Volume = 0.5
		sound.Parent = workspace.CurrentCamera
		sound:Play()
		Debris:AddItem(sound, 2)
	else
		-- VIP Willkommens-Sound
		local sound = Instance.new("Sound")
		sound.SoundId = "rbxasset://sounds/victory.wav"
		sound.Volume = 0.3
		sound.Parent = workspace.CurrentCamera
		sound:Play()
		Debris:AddItem(sound, 2)
	end

	-- Auto-remove nach Zeit
	wait(isVIP and 3 or 2)

	-- Verschwinden Animation
	TweenService:Create(frame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
		Size = UDim2.new(0, 0, 0, 0),
		Position = UDim2.new(0.5, 0, 0.4, 0)
	}):Play()

	TweenService:Create(stroke, TweenInfo.new(0.3), {
		Transparency = 1
	}):Play()

	wait(0.3)
	screenGui:Destroy()
end

-- Remote Event Handler
vipMessageRemote.OnClientEvent:Connect(function(isVIP, rank)
	showVIPMessage(isVIP, rank)
end)

print("[VIP CLIENT] Initialized")